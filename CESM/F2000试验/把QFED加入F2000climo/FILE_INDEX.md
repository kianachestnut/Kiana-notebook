# ğŸ“ CESMç«ç¾æ’æ”¾ç ”ç©¶ - æ–‡ä»¶æ€»ç´¢å¼•

## ğŸŒŸ æ ¸å¿ƒæ–‡ä»¶ (å¿…è¯»å¿…ç”¨)

### 1ï¸âƒ£ å¼€å§‹é˜…è¯»
ğŸ“˜ **README.md** - ä»è¿™é‡Œå¼€å§‹!
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- æ–‡ä»¶ç”¨é€”è¯´æ˜
- å¸¸è§é—®é¢˜ç´¢å¼•

ğŸ“˜ **COMPLETE_WORKFLOW.md** - å®Œæ•´æµç¨‹
- è¯¦ç»†åˆ†æ­¥éª¤æ“ä½œ
- æ—¶é—´å®‰æ’
- æ£€æŸ¥æ¸…å•

### 2ï¸âƒ£ CESMæ¨¡å¼è¿è¡Œ (æ ¡æœ - ywliu)
ğŸ”§ **F2000_control.csh** - Controlè¯•éªŒ (å¿…éœ€)
ğŸ”§ **F2000_QFED.csh** - QFEDè¯•éªŒ (å¿…éœ€)

### 3ï¸âƒ£ Pythonåˆ†æå·¥å…· (ç»„æœ - zzsun)
ğŸ **check_qfed.py** - QFEDæ•°æ®æ£€æŸ¥ (å¿…éœ€)
ğŸ **analyze_cesm_output.py** - ç»“æœåˆ†æ (å¿…éœ€)
ğŸ”§ **install_conda_onestep.sh** - ç¯å¢ƒå®‰è£… (å¿…éœ€)

## ğŸ“š å‚è€ƒæ–‡æ¡£

### å˜é‡å’Œé…ç½®
ğŸ“„ **fire_variables_guide.txt** - å˜é‡å®Œæ•´åˆ—è¡¨
ğŸ“„ **user_nl_cam_verified.txt** - éªŒè¯è¿‡çš„é…ç½®
ğŸ“„ **QFED_Configuration_Guide.md** - QFEDè¯¦ç»†é…ç½®

### é—®é¢˜æ’æŸ¥
ğŸ” **cesm_failure_diagnosis.md** - è¿è¡Œå¤±è´¥è¯Šæ–­
ğŸ” **quick_troubleshoot.md** - å¿«é€Ÿæ’æŸ¥
ğŸ” **diagnose_cesm.sh** - è‡ªåŠ¨è¯Šæ–­è„šæœ¬

### å¤‡ç”¨å·¥å…·
âš™ï¸ **manual_run_guide.sh** - æ‰‹åŠ¨è¿è¡ŒæŒ‡å—
âš™ï¸ **check_qfed_simple.sh** - ç®€åŒ–ç‰ˆæ£€æŸ¥(æ— éœ€Python)

## ğŸ“‚ å…¶ä»–é…ç½®æ–‡ä»¶

ğŸ“‹ **FHIST_QFED_example.csh** - FHIST compsetç¤ºä¾‹
ğŸ“‹ **F2000_QFED_standard.csh** - æ ‡å‡†é…ç½®ç‰ˆæœ¬
ğŸ“‹ **F2000_QFED_final.csh** - æœ€ç»ˆä¼˜åŒ–ç‰ˆæœ¬

---

## ğŸ¯ ä½¿ç”¨è·¯çº¿å›¾

### æ–°æ‰‹å…¥é—¨è·¯çº¿
```
1. è¯» README.md (5åˆ†é’Ÿ)
2. è¯» COMPLETE_WORKFLOW.md (20åˆ†é’Ÿ)  
3. è¿è¡Œ install_conda_onestep.sh (5åˆ†é’Ÿ)
4. è¿è¡Œ check_qfed.py (2åˆ†é’Ÿ)
5. è¿è¡Œ F2000_control.csh (30åˆ†é’Ÿ)
6. è¿è¡Œ F2000_QFED.csh (30åˆ†é’Ÿ)
7. è¿è¡Œ analyze_cesm_output.py (5åˆ†é’Ÿ)
```

### é‡åˆ°é—®é¢˜è·¯çº¿
```
1. æŸ¥ README.md "å¸¸è§é—®é¢˜"
2. æŸ¥ COMPLETE_WORKFLOW.md "é—®é¢˜æ’æŸ¥"
3. æŸ¥ cesm_failure_diagnosis.md
4. è¿è¡Œ diagnose_cesm.sh
```

### æ·±å…¥ç ”ç©¶è·¯çº¿
```
1. è¯» fire_variables_guide.txt - äº†è§£æ‰€æœ‰å˜é‡
2. è¯» QFED_Configuration_Guide.md - æ·±å…¥é…ç½®
3. ä¿®æ”¹ analyze_cesm_output.py - å®šåˆ¶åˆ†æ
4. å‚è€ƒ FHIST_QFED_example.csh - å°è¯•å…¶ä»–compset
```

---

## ğŸ“– æ–‡ä»¶è¯¦ç»†è¯´æ˜

### â­ README.md
**ç”¨é€”**: é¡¹ç›®æ€»è§ˆå’Œå¿«é€Ÿå¼€å§‹
**åŒ…å«**:
- æ–‡ä»¶æ¸…å•
- å¿«é€Ÿå¼€å§‹5æ­¥éª¤
- è·¯å¾„é…ç½®
- é¢„æœŸç»“æœ
- é—®é¢˜ç´¢å¼•

**ä½•æ—¶ä½¿ç”¨**: åˆšæ‹¿åˆ°è¿™ä¸ªæ–‡ä»¶åŒ…æ—¶ç¬¬ä¸€ä¸ªè¯»!

---

### â­ COMPLETE_WORKFLOW.md
**ç”¨é€”**: å®Œæ•´çš„ç ”ç©¶æµç¨‹æŒ‡å—
**åŒ…å«**:
- 5ä¸ªé˜¶æ®µè¯¦ç»†æ­¥éª¤
- ç¯å¢ƒå‡†å¤‡
- æ¨¡å¼è¿è¡Œ
- æ•°æ®åˆ†æ
- ç»“æœæ•´ç†
- æ—¶é—´å®‰æ’
- é—®é¢˜æ’æŸ¥
- å®Œæˆæ£€æŸ¥æ¸…å•

**ä½•æ—¶ä½¿ç”¨**: 
- ç¬¬ä¸€æ¬¡è¿è¡Œå‰é€šè¯»
- æ¯ä¸ªé˜¶æ®µå¼€å§‹å‰æŸ¥é˜…å¯¹åº”ç« èŠ‚
- é‡åˆ°é—®é¢˜æ—¶æŸ¥"å¸¸è§é—®é¢˜æ’æŸ¥"

---

### â­ F2000_control.csh
**ç”¨é€”**: Controlè¯•éªŒè„šæœ¬(æ— ç«ç¾)
**å…³é”®è®¾ç½®**:
```csh
CASE: F2000_control
RUN_STARTDATE: 2018-07-01
STOP_N: 3 (è¿è¡Œ3å¤©)
æ—  srf_emis_specifier (æ— é¢å¤–æ’æ”¾)
```

**è¿è¡Œæ–¹æ³•**:
```bash
# åœ¨æ ¡æœ ywliuç”¨æˆ·
cd /share/home/ywliu/lxyyy/scripts
csh F2000_control.csh
```

**è¾“å‡ºä½ç½®**:
```
/share/home/ywliu/lxyyy/scratch/runout/F2000_control/run/
â”œâ”€â”€ F2000_control.cam.h0.2018-07-01-00000.nc
â”œâ”€â”€ F2000_control.cam.h0.2018-07-02-00000.nc
â””â”€â”€ F2000_control.cam.h0.2018-07-03-00000.nc
```

**é¢„æœŸæ—¶é—´**: ~30-40åˆ†é’Ÿ

---

### â­ F2000_QFED.csh
**ç”¨é€”**: QFEDè¯•éªŒè„šæœ¬(å«ç«ç¾)
**å…³é”®è®¾ç½®**:
```csh
CASE: F2000_QFED_201807
RUN_STARTDATE: 2018-07-01
STOP_N: 3
srf_emis_specifier: æŒ‡å‘QFEDæ–‡ä»¶
```

**å…³é”®é…ç½®**:
```fortran
srf_emis_specifier = 
  'bc_a4  -> /work13/zzsun/lxy_data/QFED/qfed2.emis_bc.061.%y%m%d.nc4:biomass',
  'pom_a4 -> /work13/zzsun/lxy_data/QFED/qfed2.emis_oc.061.%y%m%d.nc4:biomass',
  'SO2    -> /work13/zzsun/lxy_data/QFED/qfed2.emis_so2.061.%y%m%d.nc4:biomass'
```

**éªŒè¯æ–¹æ³•**:
```bash
# æ£€æŸ¥SFbc_a4æ˜¯å¦æœ‰éé›¶å€¼
ncdump -v SFbc_a4 output.nc | tail -30
```

---

### â­ check_qfed.py
**ç”¨é€”**: QFEDæ•°æ®éªŒè¯å·¥å…·
**åŠŸèƒ½1** - æ£€æŸ¥å®Œæ•´æ€§:
```bash
python check_qfed.py /work13/zzsun/lxy_data/QFED/ --check-dir
# è¾“å‡º: OK - All files present! (æˆ–åˆ—å‡ºç¼ºå¤±æ–‡ä»¶)
```

**åŠŸèƒ½2** - æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯:
```bash
python check_qfed.py /work13/zzsun/lxy_data/QFED/qfed2.emis_bc.061.20180701.nc4
# è¾“å‡º: ç»´åº¦ã€å˜é‡ã€å•ä½ã€ç»Ÿè®¡å€¼ã€CESMé…ç½®å»ºè®®
```

**ä¾èµ–**: Python 3.x + netCDF4

---

### â­ analyze_cesm_output.py
**ç”¨é€”**: CESMè¾“å‡ºåˆ†æå’Œå¯è§†åŒ–
**åŠŸèƒ½**:
- åŠ è½½Controlå’ŒQFEDè¾“å‡º
- è®¡ç®—å·®å¼‚
- ç”Ÿæˆå¯¹æ¯”å›¾
- åŒºåŸŸç»Ÿè®¡

**è¿è¡Œæ–¹æ³•**:
```bash
conda activate cesm_analysis
python analyze_cesm_output.py
```

**è¾“å‡ºä½ç½®**:
```
/work13/zzsun/cesm_analysis/figures/
â”œâ”€â”€ SFbc_a4_20180715.png
â”œâ”€â”€ bc_a4_SRF_comparison.png
â””â”€â”€ ...
```

**å¯å®šåˆ¶**: ä¿®æ”¹è„šæœ¬ä¸­çš„åŒºåŸŸã€å˜é‡ã€æ—¶é—´èŒƒå›´

---

### â­ install_conda_onestep.sh
**ç”¨é€”**: è‡ªåŠ¨å®‰è£…Miniconda
**ç‰¹ç‚¹**:
- æ‰¹é‡æ¨¡å¼,æ— éœ€æ‰‹åŠ¨è¾“å…¥
- å…¼å®¹è€ç³»ç»Ÿ(GLIBC 2.17)
- è‡ªåŠ¨åˆå§‹åŒ–

**è¿è¡Œæ–¹æ³•**:
```bash
bash install_conda_onestep.sh
source ~/.bashrc
```

---

### ğŸ“„ fire_variables_guide.txt
**ç”¨é€”**: æ‰€æœ‰å¯ç”¨å˜é‡çš„å®Œæ•´åˆ—è¡¨
**åŒ…å«**:
- ç«ç¾æ’æ”¾é€šé‡
- æ°”æº¶èƒ¶æµ“åº¦
- å…‰å­¦ç‰¹æ€§
- è¾å°„å˜é‡
- æ°”è±¡å˜é‡
- å˜é‡å‘½åè§„åˆ™
- æ¨èé…ç½®

**ä½•æ—¶ä½¿ç”¨**: 
- è®¾è®¡è¾“å‡ºå˜é‡æ—¶
- æŸ¥è¯¢å˜é‡å«ä¹‰æ—¶
- æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨æ—¶

---

### ğŸ“„ user_nl_cam_verified.txt
**ç”¨é€”**: å·²éªŒè¯çš„user_nl_camé…ç½®
**ç‰¹ç‚¹**: æ‰€æœ‰å˜é‡éƒ½ç¡®è®¤å­˜åœ¨äºF2000climo
**ç›´æ¥ä½¿ç”¨**: å¤åˆ¶åˆ°caseçš„user_nl_camæ–‡ä»¶

---

### ğŸ” cesm_failure_diagnosis.md
**ç”¨é€”**: CESMè¿è¡Œå¤±è´¥è¯Šæ–­æŒ‡å—
**åŒ…å«**:
- 5ç±»å¸¸è§é”™è¯¯
- æ¯ç±»çš„ç—‡çŠ¶ã€åŸå› ã€è§£å†³æ–¹æ¡ˆ
- æ—¥å¿—æŸ¥çœ‹æ–¹æ³•
- å¿«é€Ÿä¿®å¤å‘½ä»¤

**ä½•æ—¶ä½¿ç”¨**: Controlæˆ–QFEDè¿è¡Œå¤±è´¥æ—¶

---

### ğŸ”§ diagnose_cesm.sh
**ç”¨é€”**: è‡ªåŠ¨è¯Šæ–­CESMè¿è¡ŒçŠ¶æ€
**åŠŸèƒ½**:
- æ£€æŸ¥ç›®å½•ç»“æ„
- æŸ¥æ‰¾æ—¥å¿—æ–‡ä»¶
- æœç´¢é”™è¯¯ä¿¡æ¯
- ç»™å‡ºè¯Šæ–­å»ºè®®

**è¿è¡Œæ–¹æ³•**:
```bash
bash diagnose_cesm.sh > diagnosis.txt
cat diagnosis.txt
```

---

## ğŸ—ºï¸ æ–‡ä»¶ä¾èµ–å…³ç³»

```
README.md (å…¥å£)
    â†“
COMPLETE_WORKFLOW.md (è¯¦ç»†æµç¨‹)
    â†“
â”œâ”€â†’ install_conda_onestep.sh (ç¯å¢ƒ)
â”œâ”€â†’ check_qfed.py (æ•°æ®æ£€æŸ¥)
â”œâ”€â†’ F2000_control.csh (Control)
â”œâ”€â†’ F2000_QFED.csh (QFED)
â”‚       â†“
â”‚   éœ€è¦: QFEDæ•°æ® + user_nl_camé…ç½®
â”‚       â†“
â”‚   å‚è€ƒ: fire_variables_guide.txt
â”‚         user_nl_cam_verified.txt
â”‚         QFED_Configuration_Guide.md
â”‚       â†“
â”œâ”€â†’ analyze_cesm_output.py (åˆ†æ)
â”‚
â””â”€â†’ é‡åˆ°é—®é¢˜:
    â”œâ”€â†’ quick_troubleshoot.md
    â”œâ”€â†’ cesm_failure_diagnosis.md
    â””â”€â†’ diagnose_cesm.sh
```

---

## âœ… æ¨èé˜…è¯»é¡ºåº

### ç¬¬ä¸€æ¬¡ä½¿ç”¨ (Day 1)
1. âœ… README.md (äº†è§£å…¨è²Œ)
2. âœ… COMPLETE_WORKFLOW.md (ç†è§£æµç¨‹)
3. âœ… fire_variables_guide.txt (äº†è§£å˜é‡)

### ç¯å¢ƒå‡†å¤‡ (Day 1-2)
4. âœ… install_conda_onestep.sh (å®‰è£…ç¯å¢ƒ)
5. âœ… check_qfed.py (éªŒè¯æ•°æ®)

### å¼€å§‹è¿è¡Œ (Day 3-4)
6. âœ… F2000_control.csh (è¿è¡ŒControl)
7. âœ… å‚è€ƒ cesm_failure_diagnosis.md (å¦‚é‡é—®é¢˜)

### ç«ç¾è¯•éªŒ (Day 5-7)
8. âœ… QFED_Configuration_Guide.md (æ·±å…¥ç†è§£)
9. âœ… F2000_QFED.csh (è¿è¡ŒQFED)

### ç»“æœåˆ†æ (Day 8-10)
10. âœ… analyze_cesm_output.py (åˆ†æç»“æœ)

---

## ğŸ’¡ ä¸“ä¸šæç¤º

### æç¤º1: ä¿å­˜ä¸­é—´ç»“æœ
```bash
# æ¯ä¸ªé˜¶æ®µå®Œæˆåæˆªå›¾æˆ–ä¿å­˜æ—¥å¿—
cp cesm.log cesm.log.backup.$(date +%Y%m%d)
```

### æç¤º2: å»ºç«‹è‡ªå·±çš„ç¬”è®°
åœ¨COMPLETE_WORKFLOW.mdæ—è¾¹åˆ›å»ºä½ è‡ªå·±çš„è¿è¡Œæ—¥å¿—

### æç¤º3: ç‰ˆæœ¬æ§åˆ¶
å¦‚æœä¿®æ”¹äº†è„šæœ¬,ä¿ç•™åŸç‰ˆæœ¬:
```bash
cp F2000_QFED.csh F2000_QFED.csh.original
```

### æç¤º4: ä¸åŒå­¦åˆ†äº«
è¿™äº›è„šæœ¬å¯ä»¥åˆ†äº«ç»™åšç±»ä¼¼ç ”ç©¶çš„åŒå­¦

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡ä»¶å†…å¸®åŠ©
- æ¯ä¸ªè„šæœ¬éƒ½æœ‰è¯¦ç»†æ³¨é‡Š
- markdownæ–‡æ¡£éƒ½æœ‰ç›®å½•ç»“æ„
- é‡åˆ°å›°æƒ‘å…ˆæœç´¢æ–‡æ¡£

### å¤–éƒ¨èµ„æº
- CESMè®ºå›: https://bb.cgd.ucar.edu/cesm/
- QFEDæ–‡æ¡£: https://portal.nccs.nasa.gov/datashare/iesa/aerosol/emissions/QFED/

---

**æœ€åæ›´æ–°**: 2025-11-24
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: å·²å®Œæˆæµ‹è¯• âœ…

ç¥ç ”ç©¶é¡ºåˆ©! ğŸ‰ğŸ”¥ğŸŒ
